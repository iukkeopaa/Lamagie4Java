## zset为什么采用跳表而不是红黑树和B+树

![clickable Avatar: undefined](https://p3-flow-imagex-sign.byteimg.com/user-avatar/assets/e7b19241fb224cea967dfaea35448102_1080_1080.png~tplv-a9rns2rl98-icon-tiny.png?rk3s=98c978ad&x-expires=1744030694&x-signature=C7rUalrhtBR52YRsbvpO1EMld8Y%3D)

恶意客户端会只发起一次握手，会对服务器造成什么影响

在 TCP（传输控制协议）通信里，正常的连接建立需要经过三次握手。若恶意客户端仅发起一次握手，也就是只发送 SYN 包却不响应后续的 SYN - ACK 包，这会对服务器造成以下影响：

### 资源占用

- **半连接队列填满**：服务器在接收到客户端的 SYN 包后，会为这个连接分配资源，如内存、缓冲区等，并且把该连接置于半连接队列里。当恶意客户端持续发送 SYN 包但不完成握手时，半连接队列会被填满。一旦队列满了，新的合法连接请求就无法被处理，会导致合法用户无法正常连接服务器。
- **CPU 和带宽消耗**：服务器为了处理这些大量的 SYN 包，会消耗大量的 CPU 资源。同时，这些无用的网络流量也会占用服务器的带宽，使得服务器处理正常业务的能力下降。

### 服务可用性降低

- **响应延迟**：由于服务器的资源被大量占用，对于正常的请求，服务器的响应时间会显著增加。这会让用户体验变差，尤其是对于对实时性要求较高的服务，如在线游戏、视频直播等。
- **服务中断**：在极端情况下，如果服务器的资源被耗尽，可能会导致服务器崩溃或者服务中断，使得所有用户都无法访问服务器。

### 潜在安全风险

- **后续攻击的铺垫**：这种仅发起一次握手的攻击可能是其他更复杂攻击的前奏。例如，攻击者可能会利用服务器资源被耗尽的时机，发起其他类型的攻击，如 SQL 注入、跨站脚本攻击（XSS）等。

为了应对这类攻击，服务器可以采取一些防护措施，像设置合理的半连接队列长度、启用 SYN Cookie 技术、部署防火墙规则来过滤异常的 SYN 包等。

除了上述措施，还有哪些方法可以应对这种攻击？

除了设置合理的半连接队列长度、启用 SYN Cookie 技术、部署防火墙规则来过滤异常 SYN 包外，还有以下方法可应对只发起一次握手的攻击：

### 服务器端优化配置

- **缩短超时时间**：服务器可以缩短半连接的超时时间。当一个半连接在设定的较短时间内没有完成三次握手，服务器就释放为其分配的资源，这样能及时回收被占用的资源，避免资源过度浪费。例如，在 Linux 系统中，可以通过修改 `/proc/sys/net/ipv4/tcp_synack_retries` 参数来调整 SYN - ACK 包的重试次数，减少等待时间。
- **增加资源容量**：从硬件层面，为服务器增加内存、CPU 等资源，提高服务器的整体处理能力和抗攻击能力。这样即使面临大量的半连接请求，服务器也能有足够的资源来处理，保证服务的正常运行。

### 采用负载均衡器

- **分散攻击流量**：部署负载均衡器可以将来自客户端的请求均匀地分发到多个服务器节点上。当遇到恶意攻击时，攻击流量会被分散到多个服务器，避免单个服务器因承受过大压力而崩溃。例如，使用 Nginx 或 HAProxy 作为负载均衡器，根据服务器的性能和负载情况进行智能分配。
- **识别和过滤攻击流量**：一些高级的负载均衡器具备流量分析和过滤功能，能够识别出异常的 SYN 包，并将其拦截在到达服务器之前。负载均衡器可以根据预设的规则，如 IP 地址黑名单、流量速率限制等，对流量进行实时监控和过滤。

### 流量清洗服务

- **专业防护**：将服务器的流量导向专业的流量清洗中心。这些清洗中心拥有强大的硬件设备和先进的算法，能够实时检测和清洗攻击流量，只将正常的流量返回给服务器。例如，阿里云、腾讯云等云服务提供商都提供流量清洗服务，可以有效地抵御各种 DDoS 攻击，包括只发起一次握手的攻击。
- **实时监控和响应**：流量清洗服务通常会提供实时的监控和报警功能，当检测到攻击流量时，会及时通知管理员，并自动采取相应的防护措施，确保服务器的安全和稳定。

### 行为分析和机器学习

- **异常检测**：通过对网络流量的行为分析和机器学习算法，建立正常流量的模型。当检测到不符合正常模型的 SYN 包时，将其判定为异常流量并进行拦截。例如，分析 SYN 包的发送频率、源 IP 地址分布等特征，识别出潜在的攻击行为。
- **自适应防护**：机器学习模型可以根据实时的网络流量情况进行自适应调整，不断优化防护策略。随着攻击手段的不断变化，这种自适应的防护机制能够更有效地应对各种新型攻击。



分享



redis的zset为什么采用跳表而不是红黑树和B+树

Redis 的有序集合（ZSet）采用跳表而非红黑树和 B+ 树，主要是基于以下几个方面的考虑：

### 与红黑树相比

#### 1. 实现复杂度

- **跳表**：跳表的实现相对简单直观。它是基于链表扩展而来，通过在链表上添加多层索引来提高查找效率。其插入、删除和查找操作的代码逻辑较为清晰，容易理解和维护。
- **红黑树**：红黑树是一种自平衡的二叉搜索树，需要通过复杂的旋转和颜色调整操作来保持树的平衡。实现红黑树需要处理多种不同的平衡情况，代码复杂度较高，维护成本也更大。

#### 2. 范围查找效率

- **跳表**：对于范围查找，跳表具有天然的优势。它可以通过索引快速定位到范围的起始位置，然后沿着链表顺序遍历，直到达到范围的结束位置。这种顺序遍历的方式非常高效，时间复杂度为 *O*(*l**o**g**n*+*m*)，其中 *n* 是集合中元素的总数，*m* 是范围内元素的数量。
- **红黑树**：红黑树在进行范围查找时，需要通过中序遍历的方式来访问元素。虽然红黑树的查找和插入操作的平均时间复杂度为 *O*(*l**o**g**n*)，但在范围查找时，需要额外的操作来定位范围的起始和结束位置，并且遍历过程相对复杂，效率不如跳表。

#### 3. 并发性能

- **跳表**：跳表的结构比较简单，在并发环境下，对跳表的操作可以更方便地进行锁粒度的控制。例如，可以只对操作涉及的部分节点进行加锁，从而提高并发性能。
- **红黑树**：红黑树的平衡操作涉及到多个节点的调整，在并发环境下需要更复杂的锁机制来保证数据的一致性。这可能会导致锁的粒度较大，从而影响并发性能。

### 与 B+ 树相比

#### 1. 内存使用

- **跳表**：跳表的每个节点只需要存储指向前驱、后继节点以及上层索引节点的指针，结构相对简单，内存开销较小。对于 Redis 这种内存数据库来说，减少内存使用是非常重要的。
- **B+ 树**：B+ 树是为磁盘存储设计的，每个节点通常会存储多个键值对和子节点指针，以减少磁盘 I/O 次数。在内存中使用 B+ 树会导致较多的内存浪费，因为 Redis 本身不需要考虑磁盘 I/O 的问题。

#### 2. 实现复杂度

- **跳表**：如前面所述，跳表的实现相对简单，易于实现和维护。
- **B+ 树**：B+ 树的实现涉及到节点的分裂、合并等复杂操作，代码复杂度较高。而且，B+ 树的节点结构和操作逻辑比较复杂，不利于在 Redis 这种对性能和代码简洁性要求较高的系统中使用。

综上所述，跳表在实现复杂度、范围查找效率、并发性能和内存使用等方面具有优势，因此 Redis 的有序集合选择了跳表作为底层数据结构。不过，Redis 的有序集合在某些版本中也会结合哈希表来提高查找效率，以充分发挥不同数据结构的优势。





